<!doctype html>
<html lang="ko" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Jake Son Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Jake Son Blog Atom Feed"><title data-rh="true">Kotlin 으로 지연평가 구현하기 | Jake Son Blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jbl428.github.io/2022/01/30/lazy-eval-in-kotlin/"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Kotlin 으로 지연평가 구현하기 | Jake Son Blog"><meta data-rh="true" name="description" content="지연평가는 함수형 프로그래밍에서 자주 등장하는 개념이며 어떤 표현식의 값을 필요로 할 때까지 평가를 미루는 방법이다."><meta data-rh="true" property="og:description" content="지연평가는 함수형 프로그래밍에서 자주 등장하는 개념이며 어떤 표현식의 값을 필요로 할 때까지 평가를 미루는 방법이다."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/jbl428"><meta data-rh="true" property="article:tag" content="kotlin,lazy-evaluation"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jbl428.github.io/2022/01/30/lazy-eval-in-kotlin/"><link data-rh="true" rel="alternate" href="https://jbl428.github.io/2022/01/30/lazy-eval-in-kotlin/" hreflang="ko"><link data-rh="true" rel="alternate" href="https://jbl428.github.io/2022/01/30/lazy-eval-in-kotlin/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.02e9836b.css">
<link rel="preload" href="/assets/js/runtime~main.4c8264c6.js" as="script">
<link rel="preload" href="/assets/js/main.05ff2abd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">본문으로 건너뛰기</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/gopher.svg" alt="Jake Son Blog" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/gopher.svg" alt="Jake Son Blog" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Jake Son Blog</b></a><a class="navbar__item navbar__link" href="/archive/">Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jbl428" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">최근 게시물</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/02/16/mikroorm-vs-typeorm/">MikroORM 과 TypeORM 비교</a></li><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/2022/01/30/lazy-eval-in-kotlin/">Kotlin 으로 지연평가 구현하기</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/01/08/convention-check-with-ts-morph/">ts-morph 로 개발 컨벤션 검증 자동화하기</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2022/01/05/querydsl-in-kotlin/">kotlin 환경에서 Querydsl 설정하기</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/2021/12/09/typeorm-transformer/">TypeORM CreateDateColumn 데코레이터와 value transformer 문제</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Kotlin 으로 지연평가 구현하기</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-01-30T00:00:00.000Z" itemprop="datePublished">2022년 1월 30일</time> · <!-- -->약 11분</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/jbl428" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/22140938?v=4" alt="Jake Son"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/jbl428" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jake Son</span></a></div><small class="avatar__subtitle" itemprop="description">Backend Developer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>지연평가는 함수형 프로그래밍에서 자주 등장하는 개념이며 어떤 표현식의 값을 필요로 할 때까지 평가를 미루는 방법이다.<br>
<!-- -->함수형 언어에서는 기본으로 모든 계산이 지연평가로 동작하기에 따로 구현할 필요는 없지만 그렇지 않은 언어에서는 각자의 언어 기능을 활용해 구현한다.</p><p>코틀린에서는 표준 위임 클래스 중 하나인 <code>Lazy</code> 를 통해 지연평가를 사용할 수 있다.<br>
<!-- -->하지만 이는 완벽한 지연평가라기 보다 프로퍼티의 지연 초기화에 가깝다.<br>
<!-- -->이번 글에서는 메모이제이션 기능이 있는 커스텀 <code>Lazy</code> 클래스를 만드는 과정을 기술하려고 한다.</p><blockquote><ul><li>모든 코드는 <a href="https://github.com/jbl428/study-note/tree/master/kotlin/lazy" target="_blank" rel="noopener noreferrer">https://github.com/jbl428/study-note/tree/master/kotlin/lazy</a> 에 있습니다.</li><li>본 글은 <a href="https://thebook.io/080208" target="_blank" rel="noopener noreferrer">코틀린을 다루는 기술</a> 에 있는 지연계산 챕터의 내용을 참고해 작성하였습니다.</li></ul></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="lazy-위임-클래스">Lazy 위임 클래스<a class="hash-link" href="#lazy-위임-클래스" title="제목으로 바로 가기">​</a></h2><p>먼저 코틀린의 Lazy 위임 클래스를 사용한 코드를 살펴보자.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> LazyTest </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation builtin">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">`내장 Lazy 테스트`</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> Foo </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> bar</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal singleline string" style="color:#e3116c">&quot;lazy&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string-literal singleline string" style="color:#e3116c">&quot;bar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">init</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal singleline string" style="color:#e3116c">&quot;init&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// when</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bar</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p>위 테스트 코드를 실행한 후 로그를 살펴보면 다음과 같이 출력된다.</p><div class="codeBlockContainer_I0IT language-text theme-code-block"><div class="codeBlockContent_wNvx text"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lazy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bar</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p><code>Foo</code> 인스턴스 생성 시 <code>init</code> 이 실행되고 <strong>&quot;init&quot;</strong> 이 출력된다.<br>
<!-- -->이후 <code>print(bar)</code> 에서 처음 <code>bar</code> 를 참조하며 <code>by lazy</code> 에 지정한 메소드가 실행된다.<br>
<!-- -->따라서 <strong>&quot;lazy&quot;</strong>, <strong>&quot;bar&quot;</strong> 가 출력되고 이후 <code>foo.bar</code> 를 참조할 때에는 <strong>&quot;lazy&quot;</strong> 는 출력되지 않는것을 확인할 수 있다.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="추가기능-구현">추가기능 구현<a class="hash-link" href="#추가기능-구현" title="제목으로 바로 가기">​</a></h2><p>이처럼 <code>Lazy</code> 위임 클래스는 프로퍼티의 초기화를 지연시킬 수 있는 기능을 제공해주고 이를 확장해 다음 기능을 추가로 구현하려고 한다.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="메모이제이션">메모이제이션<a class="hash-link" href="#메모이제이션" title="제목으로 바로 가기">​</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>메모이제이션(memoization)은 컴퓨터 프로그램이 동일한 계산을 반복해야 할 때, 이전에 계산한 값을 메모리에 저장함으로써 동일한 계산의 반복 수행을 제거하여 프로그램 실행 속도를 빠르게 하는 기술이다. (출처: wikipedia)</p></div></div><p>이전 예제코드에서 <code>by lazy</code> 에 기술한 초기화 로직은 한 번만 실행되고 이후에는 <code>bar</code> 의 값을 바로 사용하듯이 함수의 로직은 한 번만 실행되고 이후에는 결과를 바로 제공한다.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="합성">합성<a class="hash-link" href="#합성" title="제목으로 바로 가기">​</a></h3><p>지연평가 인스턴스가 반환하는 결과에 새로운 함수를 합성해 새로운 지연평가 인스턴스를 만들어준다.<br>
<!-- -->합성하는 함수는 일반적인 값을 반환하거나 새로운 지연 클래스를 반환하는 형태를 가진다.<br>
<!-- -->예를들면 아래와 같은 타입의 함수를 말한다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">normal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">newLazy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Boolean</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="커스텀-lazy-클래스">커스텀 Lazy 클래스<a class="hash-link" href="#커스텀-lazy-클래스" title="제목으로 바로 가기">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="선언">선언<a class="hash-link" href="#선언" title="제목으로 바로 가기">​</a></h3><p>먼저 아래와 같은 커스텀 Lazy 클래스를 작성한다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> A</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> value </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">operator</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invoke</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> A </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p><code>Lazy</code> 는 generic 클래스로 생성자 파라미터로 함수를 받으며 내부 value 변수의 초기화를 위해 사용된다.<br>
<code>invoke</code> 메소드는 클래스의 인스턴스를 마치 함수호출 하듯이 작성하면 수행되는 로직으로 단순히 value 를 반환한다.<br>
<!-- -->이 메소드가 처음 수행되면 초기화 함수가 실행되며 이후에는 할당을 완료한 value 를 바로 반환한다.<br>
<!-- -->이처럼 코틀린의 기본문법만 사용해도 지연평가와 메모이제이션을 손쉽게 구현할 수 있다는 것을 알 수 있다.</p><p>코틀린을 통해 얻을 수 있는 또 하나의 장점은 <code>Lazy</code> 인스턴스 생성코드가 마치 함수 선언문처럼 보이게 만들 수 있다는 것이다.<br>
<!-- -->이거는 개인적인 취향이긴 하지만 마치 Lazy 로 동작하는 block 을 만드는 것처럼 보여 더 깔끔해보인다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> lazy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal singleline string" style="color:#e3116c">&quot;lazy&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// prints &quot;lazy&quot;, returns true</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="논리연산">논리연산<a class="hash-link" href="#논리연산" title="제목으로 바로 가기">​</a></h3><p>프로그래밍 언어에서 논리연산로 등장하는 <code>or</code>, <code>and</code> 는 보통 첫 번째 표현식의 결과에 따라 다음 표현식을 평가하지 않도록 동작한다.<br>
<!-- -->예를들면 <code>or</code> 는 첫 번째 표현식이 true 이면 다음 표현식은 평가하지 않는다.<br>
<code>Lazy</code> 인스턴스로 감싼 경우에도 같은 방식으로 동작하게 된다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation builtin">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">`Or 동작 테스트`</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> lazyA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> lazyB </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Boolean</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal singleline string" style="color:#e3116c">&quot;error&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// when</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazyA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazyB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertTrue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p>만약 <code>lazyB()</code> 표현식을 평가한다면 에러가 발생하지만 <code>lazyA()</code> 가 true 를 반환하기 때문에 무시되고 테스트를 통과한다.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="map">map<a class="hash-link" href="#map" title="제목으로 바로 가기">​</a></h3><p>이제 함수를 합성할 수 있는 기능을 추가해보자.<br>
<code>map</code> 메소드는 지연평가 기능이 없는 일반적인 함수를 받아 새로운 <code>Lazy</code> 인스턴스를 만든다.<br>
<!-- -->마치 List 의 map 메소드가 배열형태는 그대로 유지한채로 내부 값들만 바꾸는것처럼 지연평가와 메모이제이션 기능은 그대로 유지한채로 최종 평가 결과물만 달라지게 해준다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> A</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> value </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">B</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">B</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p>코드를 보면 구현이 매우 간단한 것을 알 수 있다. 주어진 함수를 내부 value 를 전달해 호출하는 로직을 <code>Lazy</code> 로 감싸면된다.<br>
<!-- -->테스트 코드를 살펴보자.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation builtin">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">`Map 동작 테스트`</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> lazy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// when</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lazy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p><code>lazy</code> 인스턴스는 실행 시 <code>count</code> 를 1 증가시키고 10 을 반환한다.<br>
<!-- -->이후 map 을 호출해 내부값을 10 증가시키는 새로운 <code>Lazy</code> 인스턴스를 생성한다.<br>
<!-- -->따라서 <code>result</code> 호출 전까지는 <code>count</code> 는 0 이지만 호출이후 1 로 변하게된다.<br>
<!-- -->또한 <code>reulst()</code> 는 20 을 반환하는 것을 알 수 있다.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="flatmap">flatMap<a class="hash-link" href="#flatmap" title="제목으로 바로 가기">​</a></h3><p><code>map</code> 이 일반함수를 합성하는 역할이었다면 <code>flatMap</code> 은 <code>Lazy</code> 인스턴스를 반환하는 함수를 합성하는 역할을한다.<br>
<!-- -->만약 해당함수를 <code>map</code> 으로 합성하면 결과가 <code>Lazy&lt;Lazy&lt;A&gt;&gt;</code> 형태가 되기 때문에 사용하기 매우 불편해진다.<br>
<!-- -->그래서 <code>flatMap</code> 은 이름 그대로 <code>Lazy</code> 를 한 단계 flatten 해주는 역할을 한다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">out</span><span class="token plain"> A</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> value </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lazy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">B</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">flatMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">B</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">B</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p>이번에도 구현은 간단하다. <code>fn(value)</code> 가 <code>Lazy</code> 인스턴스를 반환하므로 바로 평가한 후 결과를 <code>Lazy</code> 로 다시 감싸면 된다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation builtin">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">`FlatMap 동작 테스트`</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> lazy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// when</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lazy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">flatMap</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p>테스트 코드도 <code>map</code> 과 거의 유사하며 <code>result()</code> 를 2번 수행해도 <code>count</code> 의 값은 1 로 유지되는 것을 알 수 있다.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sequence">sequence<a class="hash-link" href="#sequence" title="제목으로 바로 가기">​</a></h3><p>마지막으로 <code>Lazy</code> 인스턴스의 리스트를 다룰 때 사용하는 <code>sequence</code> 를 구현해보자.<br>
<code>sequence</code> 메소드는 <code>node.js</code> 개발자에게 친숙한 <code>Promise.all</code> 과 비슷한 역할을 한다.</p><p><code>Promise.all</code> 은 promise 의 배열타입인 <code>Array&lt;Promise&lt;A&gt;&gt;</code> 를 <code>Promise&lt;Array&lt;A&gt;&gt;</code> 형태의 <strong>단일 promise</strong>로 만들어준다.<br>
<!-- -->마찬가지로 <code>sequence</code> 는 <code>List&lt;Lazy&lt;A&gt;&gt;</code> 형태를 <code>Lazy&lt;List&lt;A&gt;&gt;</code> 의 <strong>단일 Lazy 인스턴스</strong>로 만들어준다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sequence</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">list</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Lazy</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">List</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">A</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">it</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p>주어진 리스트를 순회하면서 각 <code>Lazy</code> 인스턴스를 평가해 <code>List&lt;A&gt;</code> 를 얻는 로직을 <code>Lazy</code> 로 감싼다.</p><div class="codeBlockContainer_I0IT language-kt theme-code-block"><div class="codeBlockContent_wNvx kt"><pre tabindex="0" class="prism-code language-kt codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token annotation builtin">@Test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">`Sequence 동작 테스트`</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// given</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> list </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Lazy </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            count</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// when</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sequence</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toList</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">result</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">assertEquals</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="클립보드에 코드 복사" class="copyButton_wuS7 clean-btn">복사</button></div></div><p><code>list</code> 변수는 <code>Lazy</code> 인스턴스들의 배열로 최종 평가되는 값을 얻으려면 각 배열을 순회에 일일히 값을 평가하는 로직을 작성해야한다.<br>
<!-- -->하지만 <code>sequence</code> 함수를 활용해 단일 <code>Lazy</code> 인스턴스로 만들었고 그 결과인 <code>result</code> 를 수행하면 쉽게 결과를 얻을 수 있다.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>태그:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kotlin/">kotlin</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/lazy-evaluation/">lazy-evaluation</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/jbl428/jbl428.github.io/edit/main/blog/2022-01-30-lazy-eval-in-kotlin/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>페이지 편집</a></div></footer></article><div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="블로그 게시물 탐색"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2022/02/16/mikroorm-vs-typeorm/"><div class="pagination-nav__sublabel">이전 게시물</div><div class="pagination-nav__label">MikroORM 과 TypeORM 비교</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2022/01/08/convention-check-with-ts-morph/"><div class="pagination-nav__sublabel">다음 게시물</div><div class="pagination-nav__label">ts-morph 로 개발 컨벤션 검증 자동화하기</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lazy-위임-클래스" class="table-of-contents__link toc-highlight">Lazy 위임 클래스</a></li><li><a href="#추가기능-구현" class="table-of-contents__link toc-highlight">추가기능 구현</a><ul><li><a href="#메모이제이션" class="table-of-contents__link toc-highlight">메모이제이션</a></li><li><a href="#합성" class="table-of-contents__link toc-highlight">합성</a></li></ul></li><li><a href="#커스텀-lazy-클래스" class="table-of-contents__link toc-highlight">커스텀 Lazy 클래스</a><ul><li><a href="#선언" class="table-of-contents__link toc-highlight">선언</a></li><li><a href="#논리연산" class="table-of-contents__link toc-highlight">논리연산</a></li><li><a href="#map" class="table-of-contents__link toc-highlight">map</a></li><li><a href="#flatmap" class="table-of-contents__link toc-highlight">flatMap</a></li><li><a href="#sequence" class="table-of-contents__link toc-highlight">sequence</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Jake Son, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4c8264c6.js"></script>
<script src="/assets/js/main.05ff2abd.js"></script>
</body>
</html>